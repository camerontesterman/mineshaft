#!/usr/bin/ruby
#
# minecart
#
# author:: Cameron Testerman
# email:: cameronbtesterman@gmail.com
# created:: 2017-04-14 1:19PM
#
# Copyright (c) 2017 Cameron Testerman

require "minecart"
require "optparse"

options = {}

parser = OptionParser.new do |opts|
  opts.banner = "usage: minecart [options] environment"

  opts.on("v", "--version", "displays the current version of minecart") do
    puts Mineshaft::VERSION[:name] + " " + Mineshaft::VERSION[:number]
    exit
  end

  opts.on("-V",
          "--ruby-version VERSION",
          "specify the version of Ruby to install"
         ) do |version|
    options[:version] = version
  end
end

parser.parse!

unless ARGV.last.nil?
  environment = Mineshaft::Environment.new(ARGV.last)
  environment.create

  versions = JSON.parse(File.read('versions/versions.json'))

  versions.each do |number, url|
    @url = url if number == options[:version]
  end
  
  ruby_install = Mineshaft::Install.new
  ruby_install.download(@url, environment.dir)
  ruby_install.build(environment.dir)
end
