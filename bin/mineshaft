#!/usr/bin/ruby
#
# mineshaft
#
# author:: Cameron Testerman
# email:: cameronbtesterman@gmail.com
# created:: 2017-04-14 1:19PM
#
# Copyright (c) 2017 Cameron Testerman

require "mineshaft"
require "optparse"
require "yaml"

options = {}

parser = OptionParser.new do |opts|
  opts.banner = "usage: minecart [options] environment"

  opts.on("-v", "--version", "displays the current version of minecart") do
    puts "#{Mineshaft::VERSION[:name]} v#{Mineshaft::VERSION[:number]}"
    exit
  end

  opts.on("-r",
          "--ruby-version VERSION",
          "specify the version of Ruby to install"
         ) do |version|
    options[:version] = version
  end
end

parser.parse!

if ARGV.include?("new")
  dir_name = ARGV[ARGV.index("new") + 1]
  Mineshaft::Environment.new(dir_name).create

  versions = YAML.load_file(File.join(File.dirname(File.expand_path(__FILE__)), '../versions/versions.yaml'))
  version = options[:version] ? options[:version] : Mineshaft::Installer.get_latest_stable

  installer = Mineshaft::Installer.new do |config|
    config.url = versions[version]
    config.directory = dir_name
  end

  installer.run
end
