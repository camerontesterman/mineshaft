#!/usr/bin/ruby
#
# mineshaft
#
# author:: Cameron Testerman
# email:: cameronbtesterman@gmail.com
# created:: 2017-04-14 1:19PM
#
# Copyright (c) 2017-2018 Cameron Testerman

require "mineshaft"
require "optparse"
require "yaml"

options = {
  openssl_dir: "/usr/local/opt/openssl",
  version: Mineshaft::Constants::RUBY_VERSION_STABLE
}

parser = OptionParser.new do |opts|
  opts.banner = "Usage: mineshaft [command] [options]"
  opts.separator ""
  opts.separator "Commands"
  opts.separator "    new                              create new environment"
  opts.separator "    global                           installs Ruby environment globally"
  opts.separator ""
  opts.separator "Options"

  opts.on("-v",
    "--version",
    "displays the current version of mineshaft") do
      puts "Mineshaft v#{Mineshaft::VERSION}"
      exit
  end

  opts.on("-r",
    "--ruby-version VERSION",
    "specify the version of Ruby to install") do |version|
      options[:version] = version
  end

  opts.on("-o",
    "--with-openssl-dir DIR",
    "specify the directory where OpenSSL is installed") do |openssl_dir|
      options[:openssl_dir] = openssl_dir
  end
end

parser.parse!

if ARGV[0] == "new"
  dir_name = ARGV[ARGV.index("new") + 1]
  Mineshaft::Environment.new(dir_name, options).create
elsif ARGV[0] == "global"
  options[:global] = true
  Mineshaft::Environment.new(options[:version], options).create
end
